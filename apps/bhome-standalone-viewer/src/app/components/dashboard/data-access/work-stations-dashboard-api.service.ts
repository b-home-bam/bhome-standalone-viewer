import { Injectable } from '@angular/core';
import { Observable, of } from 'rxjs';

import { WorkStationsDashboardConfig } from '../interfaces/work-stations-dashboard-config.interface';
import {
  ElementWithStatus,
  OrganizationWorkStationWithStatus,
} from '../interfaces/work-stations-dashboard-state.interface';
import { WorkstationType } from '../ui/types/constants';

interface DashboardDataDto {
  workStations: OrganizationWorkStationWithStatus[];
  elements: ElementWithStatus[];
}

@Injectable({
  providedIn: 'root',
})
export class WorkStationsDashboardApiService {
  // private readonly environment = inject(RNN_ENVIRONMENT);
  // private readonly http = inject(HttpClient);
  private readonly workStationsWithStatusMock: OrganizationWorkStationWithStatus[] = [
    {
      organizationWorkStation: {
        id: '6776dd95748bcdf599013433',
        guid: 'T5.1',
        name: '5.1 Framen',
        description: 'Framingsstation',
        workStationType: 'GL1 Framen',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: {
        id: '66c7009fddd98141cf21146f',
        readableId: '001.00.Wkg.1b',
        elementType: 'Wkg',
        projectId: '6357da720bb1de59247a7b85',
        project: { name: 'PROJECTNAME', number: 'PROJECTNUMBER' },
        created: new Date(),
      },
      checkinTime: new Date('December 18, 2024 08:48:00'),
      failureMode: false,
      checkinOverdue: true,
    },
    {
      organizationWorkStation: {
        id: '66b0bc7038f56421aa07b689',
        guid: 'T5.2',
        name: '5.2 Gips opleggen',
        description: 'Folie aanbrengen en gips en OSB opleggen',
        workStationType: 'GL1 Gips opleggen',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: {
        id: '123',
        readableId: '001-01-Wbi-2a',
        elementType: '123',
        projectId: '123',
        project: { name: '123', number: '123' },
        created: new Date(),
      },
      checkinTime: new Date(),
      failureMode: false,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '66b0bc8238f56434b307b68a',
        guid: 'T5.3',
        name: '5.3 Gips bewerkingen',
        description: 'Gips bewerkingen',
        workStationType: 'GL1 Gips bewerkingen',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: false,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '66b0bc9938f5644aff07b68b',
        guid: 'T5.4',
        name: '5.4 Elektra',
        description: 'Wandcontact dozen aanbrengen, skies aanbrengen en element kantelen',
        workStationType: 'GL1 Elektra voor kanteling',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: false,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '66b0bcaf38f56430a007b68c',
        guid: 'T5.6',
        name: '5.6 Isoleren',
        description: 'Isoleren met cellulose',
        workStationType: 'GL1 Isoleren',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: false,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '66b0bcc238f5641be307b68d',
        guid: 'T5.7',
        name: '5.7 OSB beplating',
        description: 'OSB opleggen en bewerkingen',
        workStationType: 'GL1 OSB beplating',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: false,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '66b0bcd538f5642b9707b68e',
        guid: 'T5.8',
        name: '5.8 H2O beplating opleggen',
        description: 'Achterhout en H2O beplating opleggen (voorbereiding steenstrips)',
        workStationType: 'GL1 H2O beplating opleggen',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: false,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '66b0bcf538f564d80e07b68f',
        guid: 'T5.9',
        name: '5.9 Achterhout',
        description: 'Waterkeringen en achterhout (geen steenstrips)',
        workStationType: 'GL1 Achterhout',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: false,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '66b0bd0938f5646a9807b690',
        guid: 'T5.10',
        name: '5.10 H2O beplating bewerkingen',
        description: 'H2O beplating bewerkingen',
        workStationType: 'GL1 H2O beplating bewerkingen',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: false,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '66b0bd1a38f56409de07b691',
        guid: 'T5.11',
        name: '5.11 Transfer',
        description: 'Transfer naar steenstrip tafels of afwerkstation',
        workStationType: 'GL1 Transfer',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: false,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '66b0bd2d38f5644bcc07b692',
        guid: 'T5.12',
        name: '5.12 Voorbereiding steenstrips 1',
        description: 'Voorbereiding steenstrips, drie tafels',
        workStationType: 'GL1 Voorbereiding steenstrips 1',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: false,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '66b0bd3e38f564354507b693',
        guid: 'T5.15',
        name: '5.15 Voorbereiding steenstrips 2',
        description: 'Verdere voorbereiding steenstrips, na droogtijd eerdere voorbereiding',
        workStationType: 'GL1 Voorbereiding steenstrips 2',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: false,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '66b0bd4f38f56439a007b694',
        guid: 'T5.16',
        name: '5.16 Steenstrip robot',
        description: 'Steenstrip robot',
        workStationType: 'GL1 Steenstrip robot',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: true,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '66b0bd6538f564767b07b695',
        guid: 'T5.17',
        name: '5.17 Nabewerkig steenstrips',
        description: 'Nabewerking steenstrips, ankers',
        workStationType: 'GL1 Nabewerking steenstrips',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: false,
      checkinOverdue: false,
    },
    {
      organizationWorkStation: {
        id: '6724d9a4d9f0c65a494374e1',
        guid: 'T5.5',
        name: '5.5 Elektra bekabeling en klossen',
        description: 'Elektra bekabeling installeren en klossen aanbrengen ',
        workStationType: 'GL1 Elektra na kanteling',
        organizationProductionLineId: '6776dd4a748bcda7b8013432',
        organizationId: '64d9f4a8566a994e307d8a22',
        type: WorkstationType.EXECUTE,
      },
      checkedInElement: null,
      checkinTime: null,
      failureMode: false,
      checkinOverdue: false,
    },
  ];
  private readonly elementsWithStatusMock: ElementWithStatus[] = [
    {
      element: {
        id: '66c7009fddd98141cf21146f',
        readableId: '001.00.Wkg.1b',
        elementType: 'Wkg',
        projectId: '6357da720bb1de59247a7b85',
        project: { name: 'PROJECTNAME', number: 'PROJECTNUMBER' },
        created: new Date(),
      },
      geometry: { length: 4000, width: 2800, thickness: 350 },
      position: { x: 19_600, y: 18_900, z: 1100 },
      workStationId: '6776dd95748bcdf599013433',
      checkedIn: true,
      checkinTime: new Date(),
      checkinOverdue: false,
    },
  ];

  private readonly workStationsDashboardConfigsMock: WorkStationsDashboardConfig[] = [
    {
      id: '123',
      workStations: [
        {
          id: '6776dd95748bcdf599013433',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 9200,
          width: 3000,
          height: 1000,
          position: { x: 27_700, y: 18_800, z: 0 },
        },
        {
          id: '66b0bc7038f56421aa07b689',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7500,
          width: 3000,
          height: 1000,
          position: { x: 19_600, y: 18_800, z: 0 },
        },
        {
          id: '66b0bc8238f56434b307b68a',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7300,
          width: 3000,
          height: 1000,
          position: { x: 10_800, y: 18_800, z: 0 },
        },
        {
          id: '66b0bc9938f5644aff07b68b',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7000,
          width: 3000,
          height: 1000,
          position: { x: 1000, y: 18_800, z: 0 },
        },
        {
          id: '6724d9a4d9f0c65a494374e1',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7000,
          width: 3000,
          height: 1000,
          position: { x: 1100, y: 10_200, z: 0 },
        },
        {
          id: '66b0bcaf38f56430a007b68c',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 9000,
          width: 3000,
          height: 1000,
          position: { x: 9100, y: 10_200, z: 0 },
        },
        {
          id: '66b0bcc238f5641be307b68d',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 10_000,
          width: 3000,
          height: 1000,
          position: { x: 21_000, y: 10_200, z: 0 },
        },
        {
          id: '66b0bcd538f5642b9707b68e',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7000,
          width: 3000,
          height: 1000,
          position: { x: 32_000, y: 10_200, z: 0 },
        },
        {
          id: '66b0bcf538f564d80e07b68f',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 8300,
          width: 3000,
          height: 1000,
          position: { x: 40_200, y: 10_200, z: 0 },
        },
        {
          id: '66b0bd0938f5646a9807b690',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 9000,
          width: 3000,
          height: 1000,
          position: { x: 39_700, y: 2700, z: 0 },
        },
        {
          id: '66b0bd1a38f56409de07b691',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7000,
          width: 3000,
          height: 1000,
          position: { x: 49_800, y: 7500, z: 0 },
        },
        {
          id: '66b0bd2d38f5644bcc07b692',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 21_500,
          width: 3000,
          height: 1000,
          position: { x: 61_100, y: 2200, z: 0 },
        },
        {
          id: '66b0bd3e38f564354507b693',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 6000,
          width: 3000,
          height: 1000,
          position: { x: 77_000, y: 7700, z: 0 },
        },
        {
          id: '66b0bd4f38f56439a007b694',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7500,
          width: 3000,
          height: 1000,
          position: { x: 68_300, y: 7700, z: 0 },
        },
        {
          id: '66b0bd6538f564767b07b695',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7000,
          width: 3000,
          height: 1000,
          position: { x: 58_500, y: 7700, z: 0 },
        },
      ],
      zones: [],
      viewerConfig: {
        camera: {
          type: 'perspective',
          cameraSettings: {
            near: 1000,
            far: 1_000_000,
          },
          displayCameraProperties: true,
        },
        scene: {
          backgroundColor: 'white',
        },
        grid: {
          enabled: false,
          size: 100_000,
          primaryStepSize: 10_000,
          secondaryStepSize: 1000,
          primaryColor: '#a8a8a8',
          secondaryColor: '#efefef',
        },
        axesHelper: {
          enabled: false,
          size: 2000,
        },
        controls: {
          type: 'orbit',
        },
        light: {
          ambientLight: {
            enabled: true,
            color: 'white',
            intensity: 10,
          },
        },
        mapImage: {
          position: {
            x: 0,
            y: 0,
            z: -10,
          },
          cameraDistance: 10_000,
          size: {
            width: 100_000,
            height: 30_562,
          },
          offset: 500,
          url: 'assets/factory-layout.png',
        },
      },
      uiScale: 20,
      widgetOffset: 200,
    },
    {
      id: '456',
      workStations: [
        {
          id: '6776dd95748bcdf599013433',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 10,
          length: 9200,
          width: 3000,
          height: 1000,
          position: { x: 27_700, y: 18_800, z: 0 },
        },
        {
          id: '66b0bc7038f56421aa07b689',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 5,
          length: 7500,
          width: 3000,
          height: 1000,
          position: { x: 19_600, y: 18_800, z: 0 },
        },
        {
          id: '66b0bc8238f56434b307b68a',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7300,
          width: 3000,
          height: 1000,
          position: { x: 10_800, y: 18_800, z: 0 },
        },
        {
          id: '66b0bc9938f5644aff07b68b',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7000,
          width: 3000,
          height: 1000,
          position: { x: 1000, y: 18_800, z: 0 },
        },
        {
          id: '6724d9a4d9f0c65a494374e1',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7000,
          width: 3000,
          height: 1000,
          position: { x: 1100, y: 10_200, z: 0 },
        },
        {
          id: '66b0bcaf38f56430a007b68c',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 9000,
          width: 3000,
          height: 1000,
          position: { x: 9100, y: 10_200, z: 0 },
        },
        {
          id: '66b0bcc238f5641be307b68d',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 10_000,
          width: 3000,
          height: 1000,
          position: { x: 21_000, y: 10_200, z: 0 },
        },
        {
          id: '66b0bcd538f5642b9707b68e',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7000,
          width: 3000,
          height: 1000,
          position: { x: 32_000, y: 10_200, z: 0 },
        },
        {
          id: '66b0bcf538f564d80e07b68f',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 8300,
          width: 3000,
          height: 1000,
          position: { x: 40_200, y: 10_200, z: 0 },
        },
        {
          id: '66b0bd0938f5646a9807b690',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 9000,
          width: 3000,
          height: 1000,
          position: { x: 39_700, y: 2700, z: 0 },
        },
        {
          id: '66b0bd1a38f56409de07b691',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7000,
          width: 3000,
          height: 1000,
          position: { x: 49_800, y: 7500, z: 0 },
        },
        {
          id: '66b0bd2d38f5644bcc07b692',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 21_500,
          width: 3000,
          height: 1000,
          position: { x: 61_100, y: 2200, z: 0 },
        },
        {
          id: '66b0bd3e38f564354507b693',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 6000,
          width: 3000,
          height: 1000,
          position: { x: 77_000, y: 7700, z: 0 },
        },
        {
          id: '66b0bd4f38f56439a007b694',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7500,
          width: 3000,
          height: 1000,
          position: { x: 68_300, y: 7700, z: 0 },
        },
        {
          id: '66b0bd6538f564767b07b695',
          checkinZoneId: 'z1',
          checkoutZoneId: 'z2',
          showTimer: true,
          targetTime: 120,
          length: 7000,
          width: 3000,
          height: 1000,
          position: { x: 58_500, y: 7700, z: 0 },
        },
      ],
      zones: [],
      viewerConfig: {
        scene: {
          backgroundColor: 'white',
        },
        light: {
          ambientLight: {
            enabled: true,
            color: 'white',
            intensity: 1,
          },
        },
        grid: {
          enabled: false,
          size: 100_000,
          primaryStepSize: 10_000,
          secondaryStepSize: 1000,
          primaryColor: '#a8a8a8',
          secondaryColor: '#efefef',
        },
        axesHelper: {
          enabled: false,
          size: 1000,
        },
        camera: {
          type: 'orthographic',
          cameraSettings: {
            near: 0,
            far: 100_000,
          },
          displayCameraProperties: true,
        },
        controls: {
          type: 'map',
        },
        mapImage: {
          position: {
            x: 0,
            y: 0,
            z: -10,
          },
          cameraDistance: 10_000,
          size: {
            width: 100_000,
            height: 30_562,
          },
          offset: 500,
          url: 'assets/factory-layout.png',
          applyMapLimits: true,
        },
      },
      uiScale: 20,
      widgetOffset: 200,
    },
  ];

  public getWorkStationsDashboardConfig(dashboardId: string): WorkStationsDashboardConfig | undefined {
    return this.workStationsDashboardConfigsMock.find((config) => config.id === dashboardId);

    //TODO: implement backend
    //return lastValueOf his.http.get<WorkStationsDashboardConfig>(
    //   `${this.environment.RNNApiGatewayUrl}/work-stations-dashboard/${dashboardId}/config`,
    // );
  }

  public getWorkStationsAndElementsWithStatus(workStationIds: string[]): DashboardDataDto {
    return this.getworkStationsAndElementsApiCall(workStationIds);

    //TODO: implement backend
    //return lastValueOf his.http.get<WorkStationsDashboardConfig>(
    //   `${this.environment.RNNApiGatewayUrl}/TODO`,
    // );
  }

  private getworkStationsAndElementsApiCall(workStationIds: string[]): DashboardDataDto {
    const workStationsWithStatus = this.workStationsWithStatusMock.filter(
      (workStation) =>
        workStation.organizationWorkStation.id && workStationIds.includes(workStation.organizationWorkStation.id),
    );
    const elements = this.elementsWithStatusMock;

    return {
      workStations: workStationsWithStatus,
      elements: elements,
    };
  }
}
